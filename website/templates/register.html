<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register - MRSYS</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='register.css') }}" />
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="header-content">
      <h1 class="logo">MRSYS</h1>
      <nav>
        <ul>
          <li><a href="{{ url_for('views.home') }}">Home</a></li>
          <li><a href="{{ url_for('views.about') }}">About</a></li>
          <li><a href="{{ url_for('views.benefits') }}">Benefits</a></li>
          <li><a href="{{ url_for('views.contact') }}">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="register-container">
    <h2>Register</h2>
    <form id="registrationForm">
      <div class="form-group"><label for="email">Email</label><input type="email" id="email" name="email" required></div>
      <div class="form-group"><label for="password">Password</label><input type="password" id="password" name="password" required></div>
      <div class="form-group"><label for="confirm-password">Confirm Password</label><input type="password" id="confirm-password" name="confirm-password" required></div>

      <!-- Select Role Field -->
      <div class="form-group">
        <label for="role">Select Role</label>
        <select id="role" name="role" required>
          <option value="">Select role</option>
          <option value="individual">Individual</option>
          <option value="institution">Institution</option>
        </select>
      </div>

      <div class="form-group"><label for="first-name">First Name</label><input type="text" id="first-name" name="first-name" required></div>
      <div class="form-group"><label for="middle-name">Middle Name</label><input type="text" id="middle-name" name="middle-name"></div>
      <div class="form-group"><label for="last-name">Last Name</label><input type="text" id="last-name" name="last-name" required></div>
      <div class="form-group"><label for="gender">Gender</label>
        <select id="gender" name="gender" required>
          <option value="">Select gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-group"><label for="dob">Date of Birth</label><input type="date" id="dob" name="dob" required></div>
      <div class="form-group">
        <label for="region">Region</label>
        <select id="region" name="region" required>
          <option value="">Select region</option>
        </select>
      </div>
      <div class="form-group"><label for="province">Province</label><select id="province" name="province" required><option value="">Select a province</option></select></div>
      <div class="form-group"><label for="city">City/Municipality</label><select id="city" name="city" required><option value="">Select a city</option></select></div>
      <div class="form-group"><label for="barangay">Barangay</label><select id="barangay" name="barangay" required><option value="">Select a barangay</option></select></div>
      <div class="form-group"><label for="street">Street Address</label><input type="text" id="street" name="street" required></div>
      <div class="form-group"><label for="phone">Phone Number</label><input type="tel" id="phone" name="phone" required></div>
      <div class="form-group"><label for="emergency-contact">Emergency Contact</label><input type="tel" id="emergency-contact" name="emergency-contact" required></div>
      <button type="submit">Register</button>
    </form>
    <p>Already have an account? <a href="login.html">Log in here</a></p>
  </main>

  <script>
    // Dynamic dropdowns script
    document.addEventListener('DOMContentLoaded', () => {
      const regionSelect = document.getElementById('region');
      const provinceSelect = document.getElementById('province');
      const citySelect = document.getElementById('city');
      const barangaySelect = document.getElementById('barangay');
      // Fetch Regions on load
      fetch('/api/regions')
        .then(res => res.json())
        .then(data => {
          regionSelect.innerHTML = '<option value="">Select region</option>' +
            data.map(r => `<option value="${r.regionid}">${r.regionname}</option>`).join('');
        });
      regionSelect.addEventListener('change', () => {
        const regionId = regionSelect.value;
        provinceSelect.innerHTML = '<option value="">Loading...</option>';
        citySelect.innerHTML = '<option value="">Select a city</option>';
        barangaySelect.innerHTML = '<option value="">Select a barangay</option>';
        if (!regionId) {
          provinceSelect.innerHTML = '<option value="">Select a province</option>';
          return;
        }
        fetch(`/api/provinces?region_id=${regionId}`)
          .then(res => res.json())
          .then(data => {
            provinceSelect.innerHTML = '<option value="">Select a province</option>' +
              data.map(p => `<option value="${p.provinceid}">${p.provincename}</option>`).join('');
          });
      });

      provinceSelect.addEventListener('change', () => {
        const provinceId = provinceSelect.value;
        citySelect.innerHTML = '<option value="">Loading...</option>';
        barangaySelect.innerHTML = '<option value="">Select a barangay</option>';
        if (!provinceId) {
          citySelect.innerHTML = '<option value="">Select a city</option>';
          return;
        }
        fetch(`/api/cities?province_id=${provinceId}`)
          .then(res => res.json())
          .then(data => {
            citySelect.innerHTML = '<option value="">Select a city</option>' +
              data.map(c => `<option value="${c.cityid}">${c.cityname}</option>`).join('');
          });
      });

      citySelect.addEventListener('change', () => {
        const cityId = citySelect.value;
        barangaySelect.innerHTML = '<option value="">Loading...</option>';
        if (!cityId) {
          barangaySelect.innerHTML = '<option value="">Select a barangay</option>';
          return;
        }
        fetch(`/api/barangays?city_id=${cityId}`)
          .then(res => res.json())
          .then(data => {
            barangaySelect.innerHTML = '<option value="">Select a barangay</option>' +
              data.map(b => `<option value="${b.barangayid}">${b.barangayname}</option>`).join('');
          });
      });
    });

    document.getElementById("registrationForm").addEventListener("submit", function(event) {
      event.preventDefault();
      window.location.href = "member_dashboard.html";
    });
  </script> 
  <script src="{{ url_for('static', filename='register.js') }}" defer></script>

</body>
</html>
