<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manage Committee Members</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_committee_dashboard.css') }}" />
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <div class="sidebar">
    <div class="logo">MRSYS</div>
    <nav>
      <a href="{{ url_for('views.admin_dashboard') }}"><i class="fas fa-home"></i> Home</a>
      <a href="{{ url_for('views.admin_member_management') }}"><i class="fas fa-user"></i> Member Management</a>
      <a href="{{ url_for('views.admin_membership_management') }}"><i class="fas fa-id-card"></i> Membership Management</a>
      <a href="{{ url_for('views.admin_billing_payment') }}"><i class="fas fa-money-bill-wave"></i> Billing & Payment</a>
      <a href="{{ url_for('views.admin_event_management') }}"><i class="fas fa-calendar-alt"></i> Event Management</a>
      <a href="#" class="active"><i class="fas fa-users-cog"></i> Committee Dashboard</a>
      <a href="{{ url_for('views.admin_staff_management') }}"><i class="fas fa-user-shield"></i> Staff Management</a>
    </nav>
    <div class="logout">
      <a href="{{ url_for('views.home') }}"><i class="fas fa-sign-out-alt"></i> Log Out</a>
    </div>
  </div>

  <div class="main-content">
    <a href="{{ url_for('views.admin_committee_dashboard') }}" class="blue-button" style="margin-bottom: 20px; display: inline-block;">
      <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>

    <h1>Manage Committee Members</h1>
    <hr />

    <!-- Add Member Form -->
    <div class="card">
      <h2>Add New Member</h2>
      <form class="event-form" method="POST" action="{{ url_for('views.admin_committee_manage') }}">
        <div class="form-group">
          <label for="member-name">Full Name</label>
          <input type="text" id="member-name" name="member_name" placeholder="Enter full name" required>
        </div>

        <div class="form-group">
          <label for="member-email">Email Address</label>
          <input type="email" id="member-email" name="member_email" placeholder="Enter email" required>
        </div>

        <div class="form-group">
          <label for="member-role">Role</label>
          <input type="text" id="member-role" name="member_role" placeholder="e.g., Chairperson, Secretary" required>
        </div>

        <button type="submit">Add Member</button>
      </form>
    </div>

    <!-- Member Table -->
    <div class="card">
      <h2>Current Committee Members</h2>
      <table class="event-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Position</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for cm in committee_members %}
          <tr>
            <td>{{ cm.name }}</td>
            <td>{{ cm.position }}</td>
            <td>{{ cm.status }}</td>
            <td>
              <!-- Show Edit button -->
              <button type="button" onclick="toggleForm('{{ cm.committeememberid }}')" class="blue-button">Edit</button>

              <!-- Delete form -->
              <form method="POST" action="{{ url_for('views.delete_committee_manage', memberid=cm.committeememberid) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to remove this member?');">
                <button type="submit" class="blue-button">Remove</button>
              </form>
            </td>
          </tr>

          <!-- Hidden Edit Form Row -->
          <tr id="form-row-{{ cm.committeememberid }}" style="display: none;">
            <td colspan="4">
              <form action="{{ url_for('views.update_committee_manage', memberid=cm.committeememberid) }}" method="POST" style="background-color:#f5f5f5; padding:10px; border-radius:8px;">
                <input type="hidden" name="committeememberid" value="{{ cm.committeememberid }}">

                <label>Full Name:</label>
                <input type="text" name="name" value="{{ cm.name }}" readonly>

                <label>Position:</label>
                <select name="position" required>
                  <option value="Head" {% if cm.position == 'Head' %}selected{% endif %}>Head</option>
                  <option value="Subhead" {% if cm.position == 'Subhead' %}selected{% endif %}>Subhead</option>
                  <option value="Member" {% if cm.position == 'Member' %}selected{% endif %}>Member</option>
                </select>

                <label>Status:</label>
                <select name="status" required>
                  <option value="Pending" {% if cm.status == 'Pending' %}selected{% endif %}>Pending</option>
                  <option value="Approved" {% if cm.status == 'Approved' %}selected{% endif %}>Approved</option>
                  <option value="Rejected" {% if cm.status == 'Rejected' %}selected{% endif %}>Rejected</option>
                </select>

                <button type="submit" class="blue-btn">Update</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
  <script>
    function toggleForm(memberid) {
      // Hide all other forms first
      document.querySelectorAll('[id^="form-row-"]').forEach(row => {
        if (row.id !== `form-row-${memberid}`) {
          row.style.display = "none";
        }
      });

      const formRow = document.getElementById(`form-row-${memberid}`);
      formRow.style.display = formRow.style.display === "none" ? "table-row" : "none";
    }
  </script>
</body>
</html>
